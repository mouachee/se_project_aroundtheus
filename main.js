!function(){"use strict";var e=class{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._form=t}_showInputError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideInputError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_hasInvalidInput(){return!this._inputEls.every((e=>e.validity.valid))}_disableButton(){this._buttonEl.classList.add(this._inactiveButtonClass),this._buttonEl.disabled=!0}_enableButton(){this._buttonEl.classList.remove(this._inactiveButtonClass),this._buttonEl.disabled=!1}_toggleButtonState(){this._hasInvalidInput()?this._disableButton():this._enableButton()}toggleButtonState(){this._toggleButtonState()}_setEventListeners(){this._inputEls=[...this._form.querySelectorAll(this._inputSelector)],this._buttonEl=this._form.querySelector(this._submitButtonSelector),this._inputEls.forEach((e=>{e.addEventListener("input",(t=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}resetValidation(){this._form.reset(),this._toggleButtonState(),this._inputEls.forEach((e=>{this._hideInputError(e)}))}},t=class{constructor(e,t,s,r,i){this._name=e.name,this._link=e.link,this._id=e._id,this.isLiked=e.isLiked,this._cardSelector=t,this._handleImageClick=s,this._handleDeleteClick=r,this._handleLikeImage=i}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}_handlePreviewPicture(){this._handleImageClick()}handleLike(e){this.isLiked=e,this._renderLikes()}_renderLikes(){this.isLiked?this._likeButton.classList.add("card__like-button_active"):this._likeButton.classList.remove("card__like-button_active")}handleDelete(){this._element.remove(),this._element=null}_setEventListeners(){this._likeButton.addEventListener("click",(()=>{this._handleLikeImage(this)})),this._deleteButton.addEventListener("click",(()=>{this._handleDeleteClick(this)})),this._cardImage.addEventListener("click",(()=>{this._handlePreviewPicture()}))}getView(){return this._element=this._getTemplate(),this._likeButton=this._element.querySelector(".card__like-button"),this._cardImage=this._element.querySelector(".card__image"),this._deleteButton=this._element.querySelector(".card__delete-button"),this._cardTitle=this._element.querySelector(".card__title"),this._cardImage.src=this._link,this._cardImage.alt=this._name,this._cardTitle.textContent=this._name,this._setEventListeners(),this._renderLikes(),this._element}};class s{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._element=document.querySelector(t)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItems(e){this._element.prepend(e)}}class r{constructor(e){let{popupSelector:t}=e;this._popupElement=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popupElement.classList.add("modal__opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("modal__opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popupElement.addEventListener("click",(e=>{(e.target.classList.contains("modal")||e.target.classList.contains("modal__close"))&&this.close()}))}}var i=class extends r{constructor(e,t){super({popupSelector:e}),this._popupForm=this._popupElement.querySelector(".modal__form.form"),this._handleFormSubmit=t,this._inputList=this._popupForm.querySelectorAll(".form__input"),this._submitButton=this._popupForm.querySelector(".modal__button")}close(){this._popupForm.reset(),super.close()}_getInputValue(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValue())}))}setButtonLoading(){this._submitButton.textContent="Saving..."}resetButtonLoading(){this._submitButton.textContent="Save"}};document.querySelector("#card-template").content.firstElementChild;const o={inputSelector:".form__input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__error_visible"},n=(document.getElementById("profile__edit-modal"),document.getElementById("profile__edit-button")),a=(document.getElementById("profile-close-button"),document.querySelector(".profile__title")),l=document.querySelector(".profile__description"),d=document.querySelector("#profile-title-input"),c=document.querySelector("#profile-description-input"),h=document.forms["profile-edit-form"],u=(document.getElementById("add-card-modal"),document.forms["add-card-form"]),_=(u.querySelector("#add-card-title-input"),u.querySelector("#add-card-url-input"),document.querySelector("#add__card-button")),p=(document.getElementById("add-card-close-button"),document.getElementById("preview-image-modal")),m=(document.getElementById("preview-image-close-button"),document.querySelector(".cards__list"),p.querySelector(".modal__popup-image"),p.querySelector(".modal__popup-caption"),document.querySelectorAll(".modal"),document.forms["update-avatar-form"]),f=(m.querySelector("#update-avatar-url"),document.querySelector("#profile-avatar-button")),v=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getCardList(){return fetch(`${this._baseUrl}/cards`,{method:"GET",headers:this._headers}).then(this.checkResponse)}getProfileInfo(){return fetch(`${this._baseUrl}/users/me`,{method:"GET",headers:this._headers}).then(this.checkResponse)}updateProfileInfo(e){let{title:t,description:s}=e;return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:s})}).then(this.checkResponse)}addCard(e){let{name:t,link:s}=e;return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:s})}).then(this.checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this.checkResponse)}likeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this.checkResponse)}dislikeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this.checkResponse)}updateAvatar(e){let{avatar:t}=e;return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t})}).then(this.checkResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"beff3ef6-54fc-4029-9809-d6cc7f6fad90","Content-Type":"application/json"}});let E;v.getCardList().then((e=>{E=new s({items:e,renderer:e=>E.addItems(P(e))},".cards__list"),E.renderItems()})).catch((e=>{console.error(e)})),v.getProfileInfo().then((e=>{k.setUserInfo({title:e.name,description:e.about}),k.setAvatarImage({avatar:e.avatar})}));const g=new class extends r{constructor(e){super({popupSelector:e}),this._popupForm=this._popupElement.querySelector(".modal__form.form")}setSubmitAction(e){this._handleFormSubmit=e}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit()}))}}("#delete-popup-modal");g.setEventListeners();const S=new i("#add-card-modal",(function(e){S.setButtonLoading(),v.addCard({name:e.title,link:e.url}).then((e=>{E.addItems(P(e)),S.close(),I.toggleButtonState()})).catch((e=>{console.error("error add a new card",e)})).finally((()=>{S.resetButtonLoading()}))}));S.setEventListeners();const L=new i("#profile__edit-modal",(function(e){L.setButtonLoading(),v.updateProfileInfo(e).then((e=>{k.setUserInfo({title:e.name,description:e.about}),C.resetValidation(),L.close()})).catch((e=>{console.error("error",e)})).finally((()=>{L.resetButtonLoading()}))}));L.setEventListeners();const b=new i("#update-avatar-modal",(function(e){b.setButtonLoading(),v.updateAvatar(e).then((e=>{k.setAvatarImage({avatar:e.avatar}),B.resetValidation(),b.close()})).catch((e=>{console.error("error updating profile image",e)})).finally((()=>{b.resetButtonLoading()}))}));b.setEventListeners();const k=new class{constructor(e){let{profileNameSelector:t,profileDescriptionSelector:s,avatarSelector:r}=e;this._profileNameEl=t,this._profileDescriptionEl=s,this._profileAvatarEl=document.querySelector(r)}getUserInfo(){return{userProfileName:this._profileNameEl.textContent,userProfileDescription:this._profileDescriptionEl.textContent}}setUserInfo(e){let{title:t,description:s}=e;this._profileNameEl.textContent=t,this._profileDescriptionEl.textContent=s}setAvatarImage(e){let{avatar:t}=e;this._profileAvatarEl.src=t}}({profileNameSelector:a,profileDescriptionSelector:l,avatarSelector:".profile__avatar-image"}),y=new class extends r{constructor(e){super({popupSelector:e}),this._popupImage=this._popupElement.querySelector(".modal__popup-image"),this._popupCaption=this._popupElement.querySelector(".modal__popup-caption")}open(e){let{link:t,name:s}=e;this._popupImage.src=t,this._popupImage.alt=`Image ${s}`,this._popupCaption.textContent=s,super.open()}}("#preview-image-modal");y.setEventListeners();const C=new e(o,h);C.enableValidation();const I=new e(o,u);I.enableValidation();const B=new e(o,m);function q(e){g.open(e),g.setSubmitAction((()=>{v.deleteCard(e._id).then((()=>{e.handleDelete(),g.close()})).catch((e=>{console.error("error deleting card",e)}))}))}function w(e){return e.isLiked?v.dislikeCard(e._id).then((t=>{e.handleLike(t.isLiked)})).catch((e=>{console.error("Failed to like the card")})):v.likeCard(e._id).then((t=>{e.handleLike(t.isLiked)})).catch((e=>{console.error("Failed to dislike")}))}function P(e){const s=new t(e,"#card-template",(()=>function(e){y.open(e)}(e)),q,w);return s.getView()}B.enableValidation(),n.addEventListener("click",(()=>{const e=k.getUserInfo();d.value=e.userProfileName,c.value=e.userProfileDescription,L.open()})),_.addEventListener("click",(()=>{S.open()})),f.addEventListener("click",(()=>{b.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LENBR0EsU0FBU0osRUFBV3ZILEdBQ2xCLE1BQU0ySixFQUFTLElBQUlDLEVBQ2pCNUosRUFDQSxrQkFDQSxJQTdDSixTQUEwQkEsR0FDeEJ1SixFQUFldkcsS0FBS2hELEVBQ3RCLENBMkNVRSxDQUFpQkYsSUFDdkJHLEVBQ0FDLEdBRUYsT0FBT3VKLEVBQU9oSSxTQUNoQixDQTVHQWtILEVBQWdCbEosbUJBK0doQjBFLEVBQWtCNUUsaUJBQWlCLFNBQVMsS0FDMUMsTUFBTW9LLEVBQWtCaEMsRUFBU3VCLGNBQ2pDM0UsRUFBa0JULE1BQVE2RixFQUFnQlIsZ0JBQzFDM0UsRUFBd0JWLE1BQVE2RixFQUFnQlAsdUJBQ2hEWixFQUFjMUYsTUFBTSxJQUV0QjhCLEVBQWNyRixpQkFBaUIsU0FBUyxLQUN0QzBJLEVBQWFuRixNQUFNLElBRXJCaUMsRUFBYXhGLGlCQUFpQixTQUFTLEtBQ3JDbUosRUFBZ0I1RixNQUFNLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0FwaS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhDb25maXJtLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIEZvcm1WYWxpZGF0b3Ige1xuICBjb25zdHJ1Y3RvcihzZXR0aW5ncywgZm9ybUVsKSB7XG4gICAgdGhpcy5faW5wdXRTZWxlY3RvciA9IHNldHRpbmdzLmlucHV0U2VsZWN0b3I7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBzZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3RvcjtcbiAgICB0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzID0gc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcztcbiAgICB0aGlzLl9pbnB1dEVycm9yQ2xhc3MgPSBzZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3M7XG4gICAgdGhpcy5fZXJyb3JDbGFzcyA9IHNldHRpbmdzLmVycm9yQ2xhc3M7XG4gICAgdGhpcy5fZm9ybSA9IGZvcm1FbDtcbiAgfVxuICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbCkge1xuICAgIGNvbnN0IGVycm9yRWwgPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gICAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XG4gICAgZXJyb3JFbC50ZXh0Q29udGVudCA9IGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2U7XG4gICAgZXJyb3JFbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2Vycm9yQ2xhc3MpO1xuICB9XG4gIF9oaWRlSW5wdXRFcnJvcihpbnB1dEVsKSB7XG4gICAgY29uc3QgZXJyb3JFbCA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcbiAgICBpbnB1dEVsLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcbiAgICBlcnJvckVsLnRleHRDb250ZW50ID0gXCJcIjtcbiAgICBlcnJvckVsLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fZXJyb3JDbGFzcyk7XG4gIH1cbiAgX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsKSB7XG4gICAgaWYgKCFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dEVsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbCk7XG4gICAgfVxuICB9XG4gIF9oYXNJbnZhbGlkSW5wdXQoKSB7XG4gICAgcmV0dXJuICF0aGlzLl9pbnB1dEVscy5ldmVyeSgoaW5wdXRFbCkgPT4gaW5wdXRFbC52YWxpZGl0eS52YWxpZCk7XG4gIH1cbiAgX2Rpc2FibGVCdXR0b24oKSB7XG4gICAgdGhpcy5fYnV0dG9uRWwuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICB0aGlzLl9idXR0b25FbC5kaXNhYmxlZCA9IHRydWU7XG4gIH1cbiAgX2VuYWJsZUJ1dHRvbigpIHtcbiAgICB0aGlzLl9idXR0b25FbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgIHRoaXMuX2J1dHRvbkVsLmRpc2FibGVkID0gZmFsc2U7XG4gIH1cblxuICBfdG9nZ2xlQnV0dG9uU3RhdGUoKSB7XG4gICAgaWYgKHRoaXMuX2hhc0ludmFsaWRJbnB1dCgpKSB7XG4gICAgICB0aGlzLl9kaXNhYmxlQnV0dG9uKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2VuYWJsZUJ1dHRvbigpO1xuICAgIH1cbiAgfVxuICB0b2dnbGVCdXR0b25TdGF0ZSgpIHtcbiAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX2lucHV0RWxzID0gWy4uLnRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9pbnB1dFNlbGVjdG9yKV07XG4gICAgdGhpcy5fYnV0dG9uRWwgPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IodGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuXG4gICAgdGhpcy5faW5wdXRFbHMuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xuICAgICAgaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKGUpID0+IHtcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWwpO1xuICAgICAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbiAgZW5hYmxlVmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuICByZXNldFZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5fZm9ybS5yZXNldCgpO1xuICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgdGhpcy5faW5wdXRFbHMuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbCk7XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgRm9ybVZhbGlkYXRvcjtcbiIsImNsYXNzIENhcmQge1xuICBjb25zdHJ1Y3RvcihcbiAgICBjYXJkRGF0YSxcbiAgICBjYXJkU2VsZWN0b3IsXG4gICAgaGFuZGxlSW1hZ2VDbGljayxcbiAgICBoYW5kbGVEZWxldGVDbGljayxcbiAgICBoYW5kbGVMaWtlSW1hZ2VcbiAgKSB7XG4gICAgdGhpcy5fbmFtZSA9IGNhcmREYXRhLm5hbWU7XG4gICAgdGhpcy5fbGluayA9IGNhcmREYXRhLmxpbms7XG4gICAgdGhpcy5faWQgPSBjYXJkRGF0YS5faWQ7XG4gICAgdGhpcy5pc0xpa2VkID0gY2FyZERhdGEuaXNMaWtlZDtcbiAgICB0aGlzLl9jYXJkU2VsZWN0b3IgPSBjYXJkU2VsZWN0b3I7XG4gICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljayA9IGhhbmRsZUltYWdlQ2xpY2s7XG4gICAgdGhpcy5faGFuZGxlRGVsZXRlQ2xpY2sgPSBoYW5kbGVEZWxldGVDbGljaztcbiAgICB0aGlzLl9oYW5kbGVMaWtlSW1hZ2UgPSBoYW5kbGVMaWtlSW1hZ2U7XG4gIH1cbiAgLy8gQ2xvbmUgdGhlIGNhcmQgdGVtcGxhdGUgYW5kIGl0cyBjYXJkIGNvbnRlbnQgLy9cbiAgX2dldFRlbXBsYXRlKCkge1xuICAgIHJldHVybiBkb2N1bWVudFxuICAgICAgLnF1ZXJ5U2VsZWN0b3IodGhpcy5fY2FyZFNlbGVjdG9yKVxuICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXG4gICAgICAuY2xvbmVOb2RlKHRydWUpO1xuICB9XG4gIF9oYW5kbGVQcmV2aWV3UGljdHVyZSgpIHtcbiAgICB0aGlzLl9oYW5kbGVJbWFnZUNsaWNrKCk7XG4gIH1cbiAgaGFuZGxlTGlrZShpc0xpa2VkKSB7XG4gICAgdGhpcy5pc0xpa2VkID0gaXNMaWtlZDtcbiAgICB0aGlzLl9yZW5kZXJMaWtlcygpO1xuICB9XG4gIF9yZW5kZXJMaWtlcygpIHtcbiAgICBpZiAodGhpcy5pc0xpa2VkKSB7XG4gICAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2xpa2VCdXR0b24uY2xhc3NMaXN0LnJlbW92ZShcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVEZWxldGUoKSB7XG4gICAgdGhpcy5fZWxlbWVudC5yZW1vdmUoKTtcbiAgICB0aGlzLl9lbGVtZW50ID0gbnVsbDtcbiAgfVxuXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9saWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVMaWtlSW1hZ2UodGhpcyk7XG4gICAgfSk7XG4gICAgdGhpcy5fZGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVEZWxldGVDbGljayh0aGlzKTtcbiAgICB9KTtcbiAgICB0aGlzLl9jYXJkSW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZVByZXZpZXdQaWN0dXJlKCk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBHZXQgdGhlIHZpZXcgb2YgdGhlIGltYWdlcyBhbmQgdGl0bGVzIC8vXG4gIGdldFZpZXcoKSB7XG4gICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XG4gICAgdGhpcy5fbGlrZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKTtcbiAgICB0aGlzLl9jYXJkSW1hZ2UgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG4gICAgdGhpcy5fZGVsZXRlQnV0dG9uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idXR0b25cIik7XG4gICAgdGhpcy5fY2FyZFRpdGxlID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xuXG4gICAgdGhpcy5fY2FyZEltYWdlLnNyYyA9IHRoaXMuX2xpbms7XG4gICAgdGhpcy5fY2FyZEltYWdlLmFsdCA9IHRoaXMuX25hbWU7XG4gICAgdGhpcy5fY2FyZFRpdGxlLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcblxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fcmVuZGVyTGlrZXMoKTtcblxuICAgIHJldHVybiB0aGlzLl9lbGVtZW50O1xuICB9XG59XG5leHBvcnQgZGVmYXVsdCBDYXJkO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XG4gIGNvbnN0cnVjdG9yKHsgaXRlbXMsIHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XG4gICAgLy8gdGFrZSBpdGVtcyBhbmQgcmVuZGVyZXIgYXMgYW4gb2JqZWN0LCBzZWxlY3RvciBhcyBhIHN0cmluZ1xuICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICB0aGlzLl9lbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7IC8vIGZpbmQgdGhlIEhUTUwgZWxlbWVudCB1c2luZyBzZWxlY3Rvci8gXCIuY2FyZHNfX2xpc3RcIlxuICB9XG5cbiAgcmVuZGVySXRlbXMoKSB7XG4gICAgLy8gbWV0aG9kIHRvIGRpc3BsYXkgY2FyZHNcbiAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICB0aGlzLl9yZW5kZXJlcihpdGVtKTtcbiAgICB9KTtcbiAgfVxuICBhZGRJdGVtcyhlbGVtZW50KSB7XG4gICAgLy9tZXRob2QgdG8gYWRkIG5ldyBjYXJkIHRvIHRoZSBiZWdpbm5pbmcgb2YgdGhlIHNlY3Rpb25cbiAgICB0aGlzLl9lbGVtZW50LnByZXBlbmQoZWxlbWVudCk7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IoeyBwb3B1cFNlbGVjdG9yIH0pIHtcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xuICAgIHRoaXMuX2hhbmRsZUVzY0Nsb3NlID0gdGhpcy5faGFuZGxlRXNjQ2xvc2UuYmluZCh0aGlzKTtcbiAgfVxuICBvcGVuKCkge1xuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfX29wZW5lZFwiKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XG4gIH1cbiAgY2xvc2UoKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9fb3BlbmVkXCIpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgfVxuICBfaGFuZGxlRXNjQ2xvc2UoZXZ0KSB7XG4gICAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH1cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxcIikgfHxcbiAgICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9fY2xvc2VcIilcbiAgICAgICkge1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5jbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0KSB7XG4gICAgc3VwZXIoeyBwb3B1cFNlbGVjdG9yIH0pO1xuXG4gICAgdGhpcy5fcG9wdXBGb3JtID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm0uZm9ybVwiKTtcbiAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDsgLy8gYSBjYWxsYmFjayBmdW5jdGlvbiBwYXNzIGFzIGFuIGFyZ3VtZW50XG4gICAgdGhpcy5faW5wdXRMaXN0ID0gdGhpcy5fcG9wdXBGb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZm9ybV9faW5wdXRcIik7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uID0gdGhpcy5fcG9wdXBGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2J1dHRvblwiKTtcbiAgfVxuICBjbG9zZSgpIHtcbiAgICB0aGlzLl9wb3B1cEZvcm0ucmVzZXQoKTtcbiAgICBzdXBlci5jbG9zZSgpO1xuICB9XG4gIF9nZXRJbnB1dFZhbHVlKCkge1xuICAgIGNvbnN0IGlucHV0VmFsdWVzID0ge307IC8vIGFuIG9iamVjdCB0byBzdG9yZSBhbGwgdGhlIGlucHV0IHZhbHVlc1xuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgLy8gZ28gdGhyb3VnaCBlYWNoIGlucHV0IGluIHRoZSBfaW5wdXRMaXN0IHdoaWNoIHN0b3JlIGFsbCB0aGUgaW5wdXRzXG4gICAgICBpbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlOyAvL3Rha2UgdGhlIG5hbWUgYXR0cmlidXRlIG9mIHRoZSBpbnB1dCBmaWVsZCBsaWtlICh0aXRsZS9kZXNjcmlwdGlvbi91cmwpXG4gICAgICAvLyBhbmQgZ2V0IHRoZSB2YWx1ZSB0aGF0IGVudGVyZWQgZnJvbSB0aGUgdXNlcnMgYW5kIHN0b3JlIHRoZW0gaW4gdGhlIGlucHV0VmFsdWVzIG9iamVjdFxuICAgIH0pO1xuICAgIHJldHVybiBpbnB1dFZhbHVlczsgLy9pdCByZXR1cm4gYmFjayBhbGwgdGhlIG5hbWUgYW5kIHZhbHVlcyB0byB0aGUgaW5wdXRWYWx1ZXMgb2JqZWN0XG4gIH1cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTsgLy8gZ2V0IHRoZSBzZXRFdmVudExpc3RlbmVycyBmcm9tIHBhcmVudCBjbGFzcyB0byBjbG9zZSB0aGUgcG9wdXBcbiAgICB0aGlzLl9wb3B1cEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTsgLy8gcHJldmVudCBwYWdlIHJlZnJlc2hpbmdcbiAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQodGhpcy5fZ2V0SW5wdXRWYWx1ZSgpKTsgLy8gY2FsbCB0aGUgZnVuY3Rpb24gYW5kIGdpdmUgaXQgdGhlIHZhbHVlcyBmcm9tIHRoZSBmb3JtKF9nZXRJbnB1dFZhbHVlKVxuICAgIH0pO1xuICB9XG4gIHNldEJ1dHRvbkxvYWRpbmcoKSB7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZpbmcuLi5cIjtcbiAgfVxuICByZXNldEJ1dHRvbkxvYWRpbmcoKSB7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZlXCI7XG4gIH1cbn1cbmV4cG9ydCBkZWZhdWx0IFBvcHVwV2l0aEZvcm07XG4iLCJleHBvcnQgY29uc3QgaW5pdGlhbENhcmRzID0gW1xuICB7XG4gICAgbmFtZTogXCJZb3NlbWl0ZSBWYWxsZXlcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QveW9zZW1pdGUuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIkxha2UgTG91aXNlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L2xha2UtbG91aXNlLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJCYWxkIE1vdW50YWluc1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC9iYWxkLW1vdW50YWlucy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiTGF0ZW1hclwiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC9sYXRlbWFyLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJWYW5vaXNlIE5hdGlvbmFsIFBhcmtcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QvdmFub2lzZS5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiTGFnbyBkaSBCcmFpZXNcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QvbGFnby5qcGdcIixcbiAgfSxcbl07XG5cbmV4cG9ydCBjb25zdCBjYXJkVGVtcGxhdGUgPVxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIikuY29udGVudC5maXJzdEVsZW1lbnRDaGlsZDtcblxuZXhwb3J0IGNvbnN0IHZhbGlkYXRpb25TZXR0aW5ncyA9IHtcbiAgaW5wdXRTZWxlY3RvcjogXCIuZm9ybV9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19idXR0b25cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fYnV0dG9uX2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJmb3JtX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwiZm9ybV9fZXJyb3JfdmlzaWJsZVwiLFxufTtcblxuLyoqXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiAgICAgICAgICAgICAgICBwcm9maWxlIGVsZW1lbnRzXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKi9cbmV4cG9ydCBjb25zdCBwcm9maWxlRWRpdE1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwcm9maWxlX19lZGl0LW1vZGFsXCIpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXG4gIFwicHJvZmlsZV9fZWRpdC1idXR0b25cIlxuKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlQ2xvc2VCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcbiAgXCJwcm9maWxlLWNsb3NlLWJ1dHRvblwiXG4pO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVUaXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fdGl0bGVcIik7XG5leHBvcnQgY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIlxuKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlVGl0bGVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS10aXRsZS1pbnB1dFwiKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlRGVzY3JpcHRpb25JbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxuKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlRWRpdEZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcInByb2ZpbGUtZWRpdC1mb3JtXCJdO1xuXG4vKipcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqICAgICAgICAgICAgICAgIEFkZCBjYXJkcyBlbGVtZW50c1xuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICovXG5leHBvcnQgY29uc3QgYWRkQ2FyZE1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhZGQtY2FyZC1tb2RhbFwiKTtcbmV4cG9ydCBjb25zdCBhZGRDYXJkRm9ybSA9IGRvY3VtZW50LmZvcm1zW1wiYWRkLWNhcmQtZm9ybVwiXTtcbmV4cG9ydCBjb25zdCBjYXJkVGl0bGVJbnB1dCA9IGFkZENhcmRGb3JtLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI2FkZC1jYXJkLXRpdGxlLWlucHV0XCJcbik7XG5leHBvcnQgY29uc3QgY2FyZFVybElucHV0ID0gYWRkQ2FyZEZvcm0ucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC11cmwtaW5wdXRcIik7XG5leHBvcnQgY29uc3QgYWRkQ2FyZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYWRkX19jYXJkLWJ1dHRvblwiKTtcbmV4cG9ydCBjb25zdCBhZGRDYXJkQ2xvc2VCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcbiAgXCJhZGQtY2FyZC1jbG9zZS1idXR0b25cIlxuKTtcblxuLyoqXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiAgICAgICAgICAgICAgICBwcmV2aWV3IEltYWdlc1xuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICovXG5leHBvcnQgY29uc3QgcHJldmlld0ltYWdlTW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInByZXZpZXctaW1hZ2UtbW9kYWxcIik7XG5leHBvcnQgY29uc3QgcHJldmlld0ltYWdlQ2xvc2VCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcbiAgXCJwcmV2aWV3LWltYWdlLWNsb3NlLWJ1dHRvblwiXG4pO1xuZXhwb3J0IGNvbnN0IGNhcmRMaXN0RWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0XCIpO1xuZXhwb3J0IGNvbnN0IG1vZGFsSW1hZ2VFbCA9IHByZXZpZXdJbWFnZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19wb3B1cC1pbWFnZVwiXG4pO1xuZXhwb3J0IGNvbnN0IG1vZGFsQ2FwdGlvbkVsID0gcHJldmlld0ltYWdlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX3BvcHVwLWNhcHRpb25cIlxuKTtcbmV4cG9ydCBjb25zdCBtb2RhbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsXCIpO1xuXG4vL0FWQVRBUlxuZXhwb3J0IGNvbnN0IGF2YXRhckZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcInVwZGF0ZS1hdmF0YXItZm9ybVwiXTtcbmV4cG9ydCBjb25zdCBhdmF0YXJVcmwgPSBhdmF0YXJGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjdXBkYXRlLWF2YXRhci11cmxcIik7XG5leHBvcnQgY29uc3QgYXZhdGFyQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWF2YXRhci1idXR0b25cIik7XG4iLCJpbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XG5pbXBvcnQgXCIuLi9wYWdlcy9pbmRleC5jc3NcIjtcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aENvbmZpcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoQ29uZmlybS5qc1wiO1xuaW1wb3J0IHtcbiAgdmFsaWRhdGlvblNldHRpbmdzLFxuICBwcm9maWxlRWRpdEJ1dHRvbixcbiAgcHJvZmlsZVRpdGxlLFxuICBwcm9maWxlRGVzY3JpcHRpb24sXG4gIHByb2ZpbGVUaXRsZUlucHV0LFxuICBwcm9maWxlRGVzY3JpcHRpb25JbnB1dCxcbiAgcHJvZmlsZUVkaXRGb3JtLFxuICBhZGRDYXJkRm9ybSxcbiAgYWRkQ2FyZEJ1dHRvbixcbiAgYXZhdGFyRm9ybSxcbiAgYXZhdGFyQnV0dG9uLFxufSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XG5cbi8vIEFQSVxuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiYmVmZjNlZjYtNTRmYy00MDI5LTk4MDktZDZjYzdmNmZhZDkwXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcbmxldCBjYXJkU2VjdGlvbjtcbmFwaVxuICAuZ2V0Q2FyZExpc3QoKVxuICAudGhlbigoY2FyZHMpID0+IHtcbiAgICBjYXJkU2VjdGlvbiA9IG5ldyBTZWN0aW9uKFxuICAgICAge1xuICAgICAgICBpdGVtczogY2FyZHMsIC8vIHN0YXJ0IHdpdGggaW5pdGlhbENhcmRzXG4gICAgICAgIHJlbmRlcmVyOiAoY2FyZERhdGEpID0+IGNhcmRTZWN0aW9uLmFkZEl0ZW1zKGNyZWF0ZUNhcmQoY2FyZERhdGEpKSxcbiAgICAgIH0sIC8vIHVzZSB0aGUgZGF0YSB0byBjcmVhdGUgYSBjYXJkXG4gICAgICBcIi5jYXJkc19fbGlzdFwiIC8vcmVmZXIgdG8gdGhlIChzZWxlY3RvcikgaW4gc2VjdGlvbiBjbGFzc1xuICAgICk7XG4gICAgY2FyZFNlY3Rpb24ucmVuZGVySXRlbXMoKTtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmVycm9yKGVycik7XG4gIH0pO1xuXG5hcGkuZ2V0UHJvZmlsZUluZm8oKS50aGVuKCh1c2VyRGF0YSkgPT4ge1xuICB1c2VySW5mby5zZXRVc2VySW5mbyh7XG4gICAgdGl0bGU6IHVzZXJEYXRhLm5hbWUsXG4gICAgZGVzY3JpcHRpb246IHVzZXJEYXRhLmFib3V0LFxuICB9KTtcbiAgdXNlckluZm8uc2V0QXZhdGFySW1hZ2UoeyBhdmF0YXI6IHVzZXJEYXRhLmF2YXRhciB9KTtcbn0pO1xuXG4vLyBJTlNUQU5DRSBDTEFTU1xuY29uc3QgcG9wdXBXaXRoQ29uZmlybSA9IG5ldyBQb3B1cFdpdGhDb25maXJtKFwiI2RlbGV0ZS1wb3B1cC1tb2RhbFwiKTtcbnBvcHVwV2l0aENvbmZpcm0uc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuY29uc3QgYWRkUG9wdXBGb3JtID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIjYWRkLWNhcmQtbW9kYWxcIiwgaGFuZGxlQWRkQ2FyZFN1Ym1pdCk7XG5hZGRQb3B1cEZvcm0uc2V0RXZlbnRMaXN0ZW5lcnMoKTsgLy8gY2FsbCB0aGUgZXZlbnQgbGlzdGVuZXJzIGZyb20gcG9wdXBXaXRoRm9ybVxuXG5jb25zdCBlZGl0UG9wdXBGb3JtID0gbmV3IFBvcHVwV2l0aEZvcm0oXG4gIFwiI3Byb2ZpbGVfX2VkaXQtbW9kYWxcIixcbiAgaGFuZGxlUHJvZmlsZUVkaXRTdWJtaXRcbik7XG5lZGl0UG9wdXBGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IGF2YXRhclBvcHVwRm9ybSA9IG5ldyBQb3B1cFdpdGhGb3JtKFxuICBcIiN1cGRhdGUtYXZhdGFyLW1vZGFsXCIsXG4gIGhhbmRsZVVwZGF0aW5nQXZhdGFyXG4pO1xuYXZhdGFyUG9wdXBGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IHVzZXJJbmZvID0gbmV3IFVzZXJJbmZvKHtcbiAgcHJvZmlsZU5hbWVTZWxlY3RvcjogcHJvZmlsZVRpdGxlLFxuICBwcm9maWxlRGVzY3JpcHRpb25TZWxlY3RvcjogcHJvZmlsZURlc2NyaXB0aW9uLFxuICBhdmF0YXJTZWxlY3RvcjogXCIucHJvZmlsZV9fYXZhdGFyLWltYWdlXCIsXG59KTtcbmNvbnN0IHBvcHVwV2l0aEltYWdlID0gbmV3IFBvcHVwV2l0aEltYWdlKFwiI3ByZXZpZXctaW1hZ2UtbW9kYWxcIik7XG5wb3B1cFdpdGhJbWFnZS5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vLyBGT1JNIFZBTElEQVRJT05cbmNvbnN0IGVkaXRGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoXG4gIHZhbGlkYXRpb25TZXR0aW5ncyxcbiAgcHJvZmlsZUVkaXRGb3JtXG4pO1xuZWRpdEZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zdCBhZGRGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IodmFsaWRhdGlvblNldHRpbmdzLCBhZGRDYXJkRm9ybSk7XG5hZGRGb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcblxuY29uc3QgYXZhdGFyVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IodmFsaWRhdGlvblNldHRpbmdzLCBhdmF0YXJGb3JtKTtcbmF2YXRhclZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbi8vIEZVTkNUSU9OIEhBTkRMRVJTXG5mdW5jdGlvbiBoYW5kbGVVcGRhdGluZ0F2YXRhcihpbnB1dFZhbHVlcykge1xuICBhdmF0YXJQb3B1cEZvcm0uc2V0QnV0dG9uTG9hZGluZygpO1xuICBhcGlcbiAgICAudXBkYXRlQXZhdGFyKGlucHV0VmFsdWVzKVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICB1c2VySW5mby5zZXRBdmF0YXJJbWFnZSh7XG4gICAgICAgIGF2YXRhcjogZGF0YS5hdmF0YXIsXG4gICAgICB9KTtcbiAgICAgIGF2YXRhclZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24oKTtcbiAgICAgIGF2YXRhclBvcHVwRm9ybS5jbG9zZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJlcnJvciB1cGRhdGluZyBwcm9maWxlIGltYWdlXCIsIGVycik7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBhdmF0YXJQb3B1cEZvcm0ucmVzZXRCdXR0b25Mb2FkaW5nKCk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVFZGl0U3VibWl0KGlucHV0VmFsdWVzKSB7XG4gIGVkaXRQb3B1cEZvcm0uc2V0QnV0dG9uTG9hZGluZygpO1xuICBhcGlcbiAgICAudXBkYXRlUHJvZmlsZUluZm8oaW5wdXRWYWx1ZXMpXG4gICAgLnRoZW4oKHVzZXJEYXRhKSA9PiB7XG4gICAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7XG4gICAgICAgIHRpdGxlOiB1c2VyRGF0YS5uYW1lLFxuICAgICAgICBkZXNjcmlwdGlvbjogdXNlckRhdGEuYWJvdXQsXG4gICAgICB9KTtcbiAgICAgIGVkaXRGb3JtVmFsaWRhdG9yLnJlc2V0VmFsaWRhdGlvbigpO1xuICAgICAgZWRpdFBvcHVwRm9ybS5jbG9zZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJlcnJvclwiLCBlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgZWRpdFBvcHVwRm9ybS5yZXNldEJ1dHRvbkxvYWRpbmcoKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGhhbmRsZUFkZENhcmRTdWJtaXQoZGF0YSkge1xuICBhZGRQb3B1cEZvcm0uc2V0QnV0dG9uTG9hZGluZygpO1xuICBhcGlcbiAgICAuYWRkQ2FyZCh7IG5hbWU6IGRhdGEudGl0bGUsIGxpbms6IGRhdGEudXJsIH0pXG4gICAgLnRoZW4oKG5ld0NhcmQpID0+IHtcbiAgICAgIGNhcmRTZWN0aW9uLmFkZEl0ZW1zKGNyZWF0ZUNhcmQobmV3Q2FyZCkpO1xuICAgICAgYWRkUG9wdXBGb3JtLmNsb3NlKCk7XG4gICAgICBhZGRGb3JtVmFsaWRhdG9yLnRvZ2dsZUJ1dHRvblN0YXRlKCk7IC8vIGRpc2FibGVkIHRoZSBidXR0b24gYWZ0ZXIgYWRkaW5nIGEgbmV3IGNhcmQgLy9cbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiZXJyb3IgYWRkIGEgbmV3IGNhcmRcIiwgZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIGFkZFBvcHVwRm9ybS5yZXNldEJ1dHRvbkxvYWRpbmcoKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlSW1hZ2VDbGljayhjYXJkRGF0YSkge1xuICBwb3B1cFdpdGhJbWFnZS5vcGVuKGNhcmREYXRhKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlQ2xpY2soY2FyZEVsKSB7XG4gIHBvcHVwV2l0aENvbmZpcm0ub3BlbihjYXJkRWwpO1xuICBwb3B1cFdpdGhDb25maXJtLnNldFN1Ym1pdEFjdGlvbigoKSA9PiB7XG4gICAgYXBpXG4gICAgICAuZGVsZXRlQ2FyZChjYXJkRWwuX2lkKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBjYXJkRWwuaGFuZGxlRGVsZXRlKCk7XG4gICAgICAgIHBvcHVwV2l0aENvbmZpcm0uY2xvc2UoKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiZXJyb3IgZGVsZXRpbmcgY2FyZFwiLCBlcnIpO1xuICAgICAgfSk7XG4gIH0pO1xufVxuZnVuY3Rpb24gaGFuZGxlTGlrZUltYWdlKGNhcmRFbCkge1xuICBpZiAoY2FyZEVsLmlzTGlrZWQpIHtcbiAgICByZXR1cm4gYXBpXG4gICAgICAuZGlzbGlrZUNhcmQoY2FyZEVsLl9pZClcbiAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgY2FyZEVsLmhhbmRsZUxpa2UocmVzLmlzTGlrZWQpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbGlrZSB0aGUgY2FyZFwiKTtcbiAgICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBhcGlcbiAgICAgIC5saWtlQ2FyZChjYXJkRWwuX2lkKVxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICBjYXJkRWwuaGFuZGxlTGlrZShyZXMuaXNMaWtlZCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBkaXNsaWtlXCIpO1xuICAgICAgfSk7XG4gIH1cbn1cbi8vRlVOQ1RJT04gVE8gUkVOREVSIENBUkRcblxuZnVuY3Rpb24gY3JlYXRlQ2FyZChjYXJkRGF0YSkge1xuICBjb25zdCBjYXJkRWwgPSBuZXcgQ2FyZChcbiAgICBjYXJkRGF0YSxcbiAgICBcIiNjYXJkLXRlbXBsYXRlXCIsXG4gICAgKCkgPT4gaGFuZGxlSW1hZ2VDbGljayhjYXJkRGF0YSksXG4gICAgaGFuZGxlRGVsZXRlQ2xpY2ssXG4gICAgaGFuZGxlTGlrZUltYWdlXG4gICk7XG4gIHJldHVybiBjYXJkRWwuZ2V0VmlldygpO1xufVxuLy8gRVZFTlQgTElTVEVORVJTXG5cbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNvbnN0IHVzZXJJbmZvcm1hdGlvbiA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XG4gIHByb2ZpbGVUaXRsZUlucHV0LnZhbHVlID0gdXNlckluZm9ybWF0aW9uLnVzZXJQcm9maWxlTmFtZTtcbiAgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSB1c2VySW5mb3JtYXRpb24udXNlclByb2ZpbGVEZXNjcmlwdGlvbjtcbiAgZWRpdFBvcHVwRm9ybS5vcGVuKCk7XG59KTtcbmFkZENhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgYWRkUG9wdXBGb3JtLm9wZW4oKTtcbn0pO1xuYXZhdGFyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGF2YXRhclBvcHVwRm9ybS5vcGVuKCk7XG59KTtcbi8vY29tbWVudFxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuICBjaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0Q2FyZExpc3QoKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuY2hlY2tSZXNwb25zZSk7XG4gIH1cbiAgZ2V0UHJvZmlsZUluZm8oKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuY2hlY2tSZXNwb25zZSk7XG4gIH1cbiAgdXBkYXRlUHJvZmlsZUluZm8oeyB0aXRsZSwgZGVzY3JpcHRpb24gfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZTogdGl0bGUsXG4gICAgICAgIGFib3V0OiBkZXNjcmlwdGlvbixcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4odGhpcy5jaGVja1Jlc3BvbnNlKTtcbiAgfVxuICBhZGRDYXJkKHsgbmFtZSwgbGluayB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGxpbmssXG4gICAgICB9KSxcbiAgICB9KS50aGVuKHRoaXMuY2hlY2tSZXNwb25zZSk7XG4gIH1cbiAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuY2hlY2tSZXNwb25zZSk7XG4gIH1cbiAgbGlrZUNhcmQoY2FyZElkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLmNoZWNrUmVzcG9uc2UpO1xuICB9XG4gIGRpc2xpa2VDYXJkKGNhcmRJZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH0vbGlrZXNgLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5jaGVja1Jlc3BvbnNlKTtcbiAgfVxuICB1cGRhdGVBdmF0YXIoeyBhdmF0YXIgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGF2YXRhcixcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4odGhpcy5jaGVja1Jlc3BvbnNlKTtcbiAgfVxufVxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwXCI7XG5jbGFzcyBQb3B1cFdpdGhDb25maXJtIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgc3VwZXIoeyBwb3B1cFNlbGVjdG9yIH0pO1xuICAgIHRoaXMuX3BvcHVwRm9ybSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtLmZvcm1cIik7XG4gIH1cblxuICBzZXRTdWJtaXRBY3Rpb24oYWN0aW9uKSB7XG4gICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGFjdGlvbjtcbiAgfVxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX3BvcHVwRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCgpO1xuICAgIH0pO1xuICB9XG59XG5leHBvcnQgZGVmYXVsdCBQb3B1cFdpdGhDb25maXJtO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xuICBjb25zdHJ1Y3Rvcih7XG4gICAgcHJvZmlsZU5hbWVTZWxlY3RvcixcbiAgICBwcm9maWxlRGVzY3JpcHRpb25TZWxlY3RvcixcbiAgICBhdmF0YXJTZWxlY3RvcixcbiAgfSkge1xuICAgIHRoaXMuX3Byb2ZpbGVOYW1lRWwgPSBwcm9maWxlTmFtZVNlbGVjdG9yO1xuICAgIHRoaXMuX3Byb2ZpbGVEZXNjcmlwdGlvbkVsID0gcHJvZmlsZURlc2NyaXB0aW9uU2VsZWN0b3I7XG4gICAgdGhpcy5fcHJvZmlsZUF2YXRhckVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhdmF0YXJTZWxlY3Rvcik7XG4gIH1cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgLy9tZXRob2QgdG8gZ2V0IHVzZXIgaW5mb3JtYXRpb25cbiAgICByZXR1cm4ge1xuICAgICAgLy9hbiBvYmplY3QgdG8gc3RvcmUgdXNlciBpbmZvIC8vIG5hbWUvZGVzY3JpcHRpb24gdGhhdCB1c2VyIHR5cGUgdGhlcmVcbiAgICAgIHVzZXJQcm9maWxlTmFtZTogdGhpcy5fcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudCxcbiAgICAgIHVzZXJQcm9maWxlRGVzY3JpcHRpb246IHRoaXMuX3Byb2ZpbGVEZXNjcmlwdGlvbkVsLnRleHRDb250ZW50LFxuICAgIH07XG4gIH0gLy8gbWV0aG9kIHRvIHVwZGF0ZSB0aGUgdXNlciBpbmZvcm1hdGlvbiBvbiB0aGUgcGFnZVxuICBzZXRVc2VySW5mbyh7IHRpdGxlLCBkZXNjcmlwdGlvbiB9KSB7XG4gICAgLy91c2UgdGhlIG5hbWUgYXR0cmlidXRlIHRvIGFjY2VzcyB0aGUgdmFsdWVcbiAgICB0aGlzLl9wcm9maWxlTmFtZUVsLnRleHRDb250ZW50ID0gdGl0bGU7XG4gICAgdGhpcy5fcHJvZmlsZURlc2NyaXB0aW9uRWwudGV4dENvbnRlbnQgPSBkZXNjcmlwdGlvbjtcbiAgfVxuICBzZXRBdmF0YXJJbWFnZSh7IGF2YXRhciB9KSB7XG4gICAgdGhpcy5fcHJvZmlsZUF2YXRhckVsLnNyYyA9IGF2YXRhcjtcbiAgfVxufVxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5jbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgIHN1cGVyKHsgcG9wdXBTZWxlY3RvciB9KTtcblxuICAgIHRoaXMuX3BvcHVwSW1hZ2UgPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fcG9wdXAtaW1hZ2VcIik7XG4gICAgdGhpcy5fcG9wdXBDYXB0aW9uID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIi5tb2RhbF9fcG9wdXAtY2FwdGlvblwiXG4gICAgKTtcbiAgfVxuICBvcGVuKHsgbGluaywgbmFtZSB9KSB7XG4gICAgdGhpcy5fcG9wdXBJbWFnZS5zcmMgPSBsaW5rO1xuICAgIHRoaXMuX3BvcHVwSW1hZ2UuYWx0ID0gYEltYWdlICR7bmFtZX1gO1xuICAgIHRoaXMuX3BvcHVwQ2FwdGlvbi50ZXh0Q29udGVudCA9IG5hbWU7XG5cbiAgICBzdXBlci5vcGVuKCk7IC8vY2FsbCB0aGUgb3BlbigpIGZyb20gcG9wdXAgdG8gbWFrZSBzdXJlIGl0IG9wZW5zXG4gIH1cbn1cbmV4cG9ydCBkZWZhdWx0IFBvcHVwV2l0aEltYWdlO1xuIl0sIm5hbWVzIjpbImNvbnN0cnVjdG9yIiwic2V0dGluZ3MiLCJmb3JtRWwiLCJ0aGlzIiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiX2Vycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiX2Zvcm0iLCJfc2hvd0lucHV0RXJyb3IiLCJpbnB1dEVsIiwiZXJyb3JFbCIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsImNsYXNzTGlzdCIsImFkZCIsInRleHRDb250ZW50IiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfaGlkZUlucHV0RXJyb3IiLCJyZW1vdmUiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwidmFsaWRpdHkiLCJ2YWxpZCIsIl9oYXNJbnZhbGlkSW5wdXQiLCJfaW5wdXRFbHMiLCJldmVyeSIsIl9kaXNhYmxlQnV0dG9uIiwiX2J1dHRvbkVsIiwiZGlzYWJsZWQiLCJfZW5hYmxlQnV0dG9uIiwiX3RvZ2dsZUJ1dHRvblN0YXRlIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiZW5hYmxlVmFsaWRhdGlvbiIsImV2dCIsInByZXZlbnREZWZhdWx0IiwicmVzZXRWYWxpZGF0aW9uIiwicmVzZXQiLCJjYXJkRGF0YSIsImNhcmRTZWxlY3RvciIsImhhbmRsZUltYWdlQ2xpY2siLCJoYW5kbGVEZWxldGVDbGljayIsImhhbmRsZUxpa2VJbWFnZSIsIl9uYW1lIiwibmFtZSIsIl9saW5rIiwibGluayIsIl9pZCIsImlzTGlrZWQiLCJfY2FyZFNlbGVjdG9yIiwiX2hhbmRsZUltYWdlQ2xpY2siLCJfaGFuZGxlRGVsZXRlQ2xpY2siLCJfaGFuZGxlTGlrZUltYWdlIiwiX2dldFRlbXBsYXRlIiwiZG9jdW1lbnQiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiX2hhbmRsZVByZXZpZXdQaWN0dXJlIiwiaGFuZGxlTGlrZSIsIl9yZW5kZXJMaWtlcyIsIl9saWtlQnV0dG9uIiwiaGFuZGxlRGVsZXRlIiwiX2VsZW1lbnQiLCJfZGVsZXRlQnV0dG9uIiwiX2NhcmRJbWFnZSIsImdldFZpZXciLCJfY2FyZFRpdGxlIiwic3JjIiwiYWx0IiwiU2VjdGlvbiIsIl9yZWYiLCJjb250YWluZXJTZWxlY3RvciIsIml0ZW1zIiwicmVuZGVyZXIiLCJfaXRlbXMiLCJfcmVuZGVyZXIiLCJyZW5kZXJJdGVtcyIsIml0ZW0iLCJhZGRJdGVtcyIsImVsZW1lbnQiLCJwcmVwZW5kIiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwiX3BvcHVwRWxlbWVudCIsIl9oYW5kbGVFc2NDbG9zZSIsImJpbmQiLCJvcGVuIiwiY2xvc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwia2V5Iiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJ0YXJnZXQiLCJjb250YWlucyIsImhhbmRsZUZvcm1TdWJtaXQiLCJzdXBlciIsIl9wb3B1cEZvcm0iLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl9pbnB1dExpc3QiLCJfc3VibWl0QnV0dG9uIiwiX2dldElucHV0VmFsdWUiLCJpbnB1dFZhbHVlcyIsImlucHV0IiwidmFsdWUiLCJzZXRCdXR0b25Mb2FkaW5nIiwicmVzZXRCdXR0b25Mb2FkaW5nIiwiZmlyc3RFbGVtZW50Q2hpbGQiLCJ2YWxpZGF0aW9uU2V0dGluZ3MiLCJwcm9maWxlRWRpdEJ1dHRvbiIsImdldEVsZW1lbnRCeUlkIiwicHJvZmlsZVRpdGxlIiwicHJvZmlsZURlc2NyaXB0aW9uIiwicHJvZmlsZVRpdGxlSW5wdXQiLCJwcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsInByb2ZpbGVFZGl0Rm9ybSIsImZvcm1zIiwiYWRkQ2FyZEZvcm0iLCJhZGRDYXJkQnV0dG9uIiwicHJldmlld0ltYWdlTW9kYWwiLCJhdmF0YXJGb3JtIiwiYXZhdGFyQnV0dG9uIiwiYXBpIiwiYmFzZVVybCIsImhlYWRlcnMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiY2hlY2tSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJnZXRDYXJkTGlzdCIsImZldGNoIiwibWV0aG9kIiwidGhlbiIsImdldFByb2ZpbGVJbmZvIiwidXBkYXRlUHJvZmlsZUluZm8iLCJfcmVmMiIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFib3V0IiwiYWRkQ2FyZCIsIl9yZWYzIiwiZGVsZXRlQ2FyZCIsImNhcmRJZCIsImxpa2VDYXJkIiwiZGlzbGlrZUNhcmQiLCJ1cGRhdGVBdmF0YXIiLCJfcmVmNCIsImF2YXRhciIsImF1dGhvcml6YXRpb24iLCJjYXJkU2VjdGlvbiIsImNhcmRzIiwiY3JlYXRlQ2FyZCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwidXNlckRhdGEiLCJ1c2VySW5mbyIsInNldFVzZXJJbmZvIiwic2V0QXZhdGFySW1hZ2UiLCJwb3B1cFdpdGhDb25maXJtIiwic2V0U3VibWl0QWN0aW9uIiwiYWN0aW9uIiwiYWRkUG9wdXBGb3JtIiwiUG9wdXBXaXRoRm9ybSIsImRhdGEiLCJ1cmwiLCJuZXdDYXJkIiwiYWRkRm9ybVZhbGlkYXRvciIsImZpbmFsbHkiLCJlZGl0UG9wdXBGb3JtIiwiZWRpdEZvcm1WYWxpZGF0b3IiLCJhdmF0YXJQb3B1cEZvcm0iLCJhdmF0YXJWYWxpZGF0b3IiLCJwcm9maWxlTmFtZVNlbGVjdG9yIiwicHJvZmlsZURlc2NyaXB0aW9uU2VsZWN0b3IiLCJhdmF0YXJTZWxlY3RvciIsIl9wcm9maWxlTmFtZUVsIiwiX3Byb2ZpbGVEZXNjcmlwdGlvbkVsIiwiX3Byb2ZpbGVBdmF0YXJFbCIsImdldFVzZXJJbmZvIiwidXNlclByb2ZpbGVOYW1lIiwidXNlclByb2ZpbGVEZXNjcmlwdGlvbiIsInBvcHVwV2l0aEltYWdlIiwiX3BvcHVwSW1hZ2UiLCJfcG9wdXBDYXB0aW9uIiwiRm9ybVZhbGlkYXRvciIsImNhcmRFbCIsIkNhcmQiLCJ1c2VySW5mb3JtYXRpb24iXSwic291cmNlUm9vdCI6IiJ9